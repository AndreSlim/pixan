/*
 * NoGray Color Picker Component
 *
 * Copyright (c), All right reserved
 * Gazing Design - http://www.NoGray.com
 * http://www.nogray.com/license.php
 */

/*[NGLITEONLY OPEN]*/
ng.Language.set_language('en', {
	apply: 'Apply',
	opacity: 'Opacity'
});
/*[NGLITEONLY CLOSE]*/

ng.Assets.load_style(ng_config.assets_dir+"components/colorpicker/css/"+ng_config.css_skin_prefix+"colorpicker_style.css");ng.ColorPicker=function(b){this.p=this.create_options(b,{value:null,current_color:"#ff0000",standard_colors:[["#ff8080","#ffff80","#80ff80","#00ff80","#80ffff","#0080ff","#ff80c0","#ff80ff"],["#ff0000","#ffff00","#80ff00","#00ff40","#00ffff","#0080c0","#8080c0","#ff00ff"],["#804040","#ff8040","#00ff00","#008080","#004080","#8080ff","#800040","#ff0080"],["#800000","#ff8000","#008000","#008040","#0000ff","#0000a0","#800080","#8000ff"],["#400000","#804000","#004000","#004040","#000080","#000040","#400040","#400080"],["#000000","#808000","#808040","#808080","#408080","#c0c0c0","#400040","#ffffff"]],css_prefix:"ng_colorpicker_",picker_image:ng_config.assets_dir+"components/colorpicker/images/picker_icon.png",picker_image_disabled:ng_config.assets_dir+"components/colorpicker/images/picker_icon_disabled.png",close_on_select:true,opacity:false});this.make_id("colorpicker");this.create_events();if(!ng.defined(ng.Slider)){this.p.swatches_only=true}if(this.p.disabled){this.p.disabled=false;this.disable.delay(100,this)}if(ng.defined(this.p.value)){if(ng.type(this.p.value)=="color"){this.p.value=this.p.value.get_hex(true)}var a=this.p.value;this.p.value="";this.select_color.defer(this,[a,true])}if(ng.defined(this.p.input)){this.set_input(this.p.input)}if((ng.defined(this.p.input))||(ng.defined(this.p.object))){this.make()}};ng.ColorPicker.inherit(ng.Component);ng.extend_proto(ng.ColorPicker,{has_type:"color_picker",make:function(b){if(ng.defined(b)){this.set_input(b)}if(ng.defined(this.p.input)){this.p.input.type="text"}var e=this.p.css_prefix;var g=this.id;this.p.click_evt=new ng.InnerHtmlEvents({click:function(l,i){var h=i.src_element.get("rel");if(ng.defined(h)){if(h.indexOf("select_")!=-1){var j=new ng.Color(h.replace("select_",""));var k=this.get_current_color().get_alpha();j.set_alpha(k);this.select_color(j)}else{if(h.indexOf("update_")!=-1){this.set_current_color(i.src_element.get_style("backgroundColor"))}}}}.ng_bind(this)});var d=['<div id="'+g+'_swatch_div" '+this.p.click_evt.get_html()+"><span></span>"];d.push('<div id="'+g+'_opacity_div" class="'+e+'opacity_div"');if(!this.p.opacity){d.push(' style="display:none;"')}d.push('"><table width="100%"><tr><td>'+ng.Language.t("opacity")+": </td>");d.push('<td><input type="text" id="'+g+'_opacity_input1" size="5" /> %</td>');d.push('<td id="'+g+'_apply_opacity_td"></td></tr></table></div>');d.push("</div>");var f={color:this.p.buttons_color,over_color:this.p.buttons_over_color,down_color:this.p.buttons_down_color,disable_color:this.p.buttons_disable_color,gloss:this.p.buttons_gloss,checked_color:this.p.buttons_checked_color,light_border:this.p.buttons_light_border};this.set_html(d);this.p.opacity_input1=ng.get(g+"_opacity_input1");this.p.opacity_evt_func=function(h){var j=h.src_element.value.to_int();if(isNaN(j)){j=100}var i=this.get_current_color();i.set_alpha(j/100);this.set_current_color(i)}.ng_bind(this);this.p.opacity_input1.add_event("change",this.p.opacity_evt_func);this.p.apply_opacity_button=new ng.Button(ng.obj_merge({text:ng.Language.t("apply",this.get_language()),language:this.get_language(),events:{click:function(){this.select_color(this.get_current_color())}.ng_bind(this)}},f));this.p.apply_opacity_button.make(g+"_apply_opacity_td");var a=this.get_input();if(ng.defined(a)){if((!ng.defined(this.p.value))&&(a.value!="")){this.select_color.defer(this,[a.value,true])}a.add_events({change:function(){var h=this.get_input().value;if(h==""){this.unselect_color()}else{this.select_color(h)}}.ng_bind(this)});var d=this.get_input_html();ng.hold_html(d);var c=ng.get("input_button_container"+this.id);a.append_element(c,"before");if(ng.defined(ng.UI)){c.append_element(a)}else{ng.get("input_holder_td"+this.id).append_element(a)}this.p.icon_button=new ng.Button(ng.obj_merge({icon:this.p.picker_image,stop_default:true,hide_component:true,language:this.get_language(),events:{disable:function(){this.p.icon_button.set_icon(this.p.picker_image_disabled)}.ng_bind(this),enable:function(){this.p.icon_button.set_icon(this.p.picker_image)}.ng_bind(this)}},f));if(ng.defined(ng.UI)){this.p.icon_button.make(c)}else{this.p.icon_button.make("button_holder_td"+this.id)}this.set_button(this.p.icon_button);if(a.disabled){this.disable.delay(100,this)}}this.set_standard_colors(this.p.standard_colors);this.set_current_color(this.p.current_color);this.set_previous_color(this.p.current_color);return this},process_color:function(a){if(!ng.defined(this.p.elm)){this.p.elm=ng.create("div")}if(ng.type(a)=="string"){a=a.toLowerCase();if(a.indexOf("rgb")!=-1){a=a.replace(/[rgb(a)?|\(|\)|\s]/g,"");a=new ng.Color(a.split(","))}else{if(a.indexOf("hsl")!=-1){a=a.replace(/[hsl(a)?|\(|\)|\s]/g,"");a=new ng.Color(a.split(","),"hsl")}else{if(a.substr(0,1)!="#"){a="#"+a}}}}this.p.elm.set_style("backgroundColor",a);a=this.p.elm.get_style("backgroundColor");return new ng.Color(a)},select_color:function(b,d){if(this.is_disabled()){return this}var b=this.process_color(b);if((ng.defined(this.p.value))&&(this.p.value!="")){this.unselect_color()}this.p.value=b;var c=this.get_button();if(ng.defined(c)){c.get_icon_element().set_style("backgroundColor",b)}var e=ng.get(this.id+"_swatch_td_"+b.get_hex(false).toUpperCase().replace("#",""));if(ng.defined(e)){e.add_class(this.p.css_prefix+"selected")}var a=this.get_input();if(ng.defined(a)){if(b.get_alpha()!=1){a.value="rgba("+b.get_rgb(true).join(",")+")"}else{a.value=b.get_hex(false)}}this.set_current_color(b);this.set_previous_color(b);if(!ng.defined(d)){this.fire_event("select")}if(this.p.close_on_select){this.close()}return this},unselect_color:function(){if(this.is_disabled()){return this}if((ng.defined(this.p.value))&&(this.p.value!="")){this.set_previous_color(this.p.value)}var b=this.get_button();if(ng.defined(b)){b.get_icon_element().set_style("background","none")}var a=this.get_current_color();var c=ng.get(this.id+"_swatch_td_"+a.get_hex().toUpperCase().replace("#",""));if(ng.defined(c)){c.remove_class(this.p.css_prefix+"selected")}this.p.value=null;this.fire_event("unselect",[a]);return this},get_value:function(){return this.p.value},set_current_color:function(b,a){if(this.is_disabled()){return this}b=this.process_color(b);this.p.current_color=b;this.p.opacity_input1.value=b.get_alpha()*100;this.fire_event("colorchange");return this},get_current_color:function(){return this.p.current_color},set_previous_color:function(a){if(this.is_disabled()){return this}a=this.process_color(a);this.p.previous_color=a;if(!this.p.swatches_only){ng.get(this.id+"_previous_color_div").set_style("backgroundColor",a)}return this},get_previous_color:function(){return this.p.previous_color},set_standard_colors:function(h){this.p.standard_colors=h;var g=this.id;if(ng.defined(h)){var d=['<table class="'+this.p.css_prefix+'swatch_table">'];for(var c=0;c<h.length;c++){d.push("<tr>");for(var b=0;b<h[c].length;b++){var a=h[c][b];if(ng.type(a)=="color"){a=a.get_hex()}var f=a.toUpperCase().replace("#","");d.push('<td id="'+g+"_swatch_td_"+f+'" class="'+this.p.css_prefix+'swatch_td">');d.push('<div rel="select_'+a+'" class="ng_colorpicker_swatch" style="background:'+a+';">&nbsp;</div></td>')}d.push("</tr>")}d.push("</table>");var e=ng.get(g+"_swatch_div").getElementsByTagName("span")[0];e.innerHTML=d.join("");if(!this.p.swatches_only){this.p.swatches_button.get_object().set_style("display","")}}else{var e=ng.get(g+"_swatch_div").getElementsByTagName("span")[0];e.innerHTML="";if(!this.p.swatches_only){this.p.more_colors_button.fire_event("click")}this.p.swatches_button.get_object().set_style("display","none")}return this},get_standard_colors:function(){return this.p.standard_colors},set_close_on_select:function(a){this.close_on_select=a;return this},get_close_on_select:function(){return this},set_opacity:function(b){this.p.opacity=b;if(b){var a=""}else{var a="none"}ng.get(this.id+"_opacity_div").set_style("display",a);ng.get(this.id+"_opacity_advance_div").set_style("display",a);return this},get_opacity:function(){return this.p.opacity},toString:function(){return this.p.value.toString()}});if(ng.defined(ng.UI)){ng.UI.add_to_ini("ng-colorpicker",function(a){ng.UI.common_ini(a,ng.ColorPicker)})};